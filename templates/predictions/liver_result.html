{% extends 'base.html' %}
{% block title %}Liver Disease Analysis - Dr. Charaka{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-12 col-xl-10">
            <!-- Header Section -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-1 text-gray-900" style="font-weight: 700;">Liver Disease Analysis</h1>
                    <p class="text-muted mb-0">AI-powered diagnostic assessment</p>
                </div>
                <div class="d-flex gap-2">
                    <span class="badge bg-light text-dark px-3 py-2" style="font-size: 0.8rem;">
                        <i class="fas fa-calendar-alt me-1"></i>
                        {{ prediction.created_at|date:"M d, Y" }}
                    </span>
                </div>
            </div>

            <div class="row g-4">
                <!-- Main Result Card -->
                <div class="col-12 col-lg-8">
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body p-4">
                            <!-- Patient Info Header -->
                            <div class="d-flex align-items-center justify-content-between mb-4 pb-3 border-bottom">
                                <div>
                                    <h5 class="mb-1 text-gray-900">{{ prediction.patient.first_name }} {{ prediction.patient.last_name }}</h5>
                                    <div class="d-flex gap-3 text-muted" style="font-size: 0.875rem;">
                                        <span><i class="fas fa-user me-1"></i>{{ prediction.age }} years</span>
                                        <span><i class="fas fa-venus-mars me-1"></i>{{ prediction.gender }}</span>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <span class="badge bg-light text-dark">ID: #{{ prediction.id }}</span>
                                </div>
                            </div>

                            <!-- Result Status -->
                            <div class="text-center py-4">
                                {% if prediction.prediction == 'No Disease' %}
                                    <div class="mb-3">
                                        <div class="d-inline-flex align-items-center justify-content-center bg-success bg-opacity-10 rounded-circle" style="width: 80px; height: 80px;">
                                            <i class="fas fa-check-circle text-success" style="font-size: 2.5rem;"></i>
                                        </div>
                                    </div>
                                    <h3 class="text-success mb-2" style="font-weight: 600;">Normal Liver Function</h3>
                                    <p class="text-muted mb-3">No signs of liver disease detected</p>
                                {% else %}
                                    <div class="mb-3">
                                        <div class="d-inline-flex align-items-center justify-content-center bg-warning bg-opacity-10 rounded-circle" style="width: 80px; height: 80px;">
                                            <i class="fas fa-exclamation-triangle text-warning" style="font-size: 2.5rem;"></i>
                                        </div>
                                    </div>
                                    <h3 class="text-warning mb-2" style="font-weight: 600;">Liver Disease Detected</h3>
                                    <p class="text-muted mb-3">Further evaluation recommended</p>
                                {% endif %}
                                
                                <div class="d-inline-flex align-items-center gap-2 bg-light rounded-pill px-3 py-2">
                                    <span class="text-muted" style="font-size: 0.875rem;">Confidence Level:</span>
                                    <span class="fw-semibold text-primary">{{ prediction.confidence|floatformat:1 }}%</span>
                                </div>
                            </div>

                            <!-- Lab Values Grid -->
                            <div class="mt-4">
                                <h6 class="text-gray-700 mb-3" style="font-weight: 600;">Laboratory Values</h6>
                                <div class="row g-3">
                                    <div class="col-6 col-md-4">
                                        <div class="bg-light rounded p-3 text-center">
                                            <div class="text-muted mb-1" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Total Bilirubin</div>
                                            <div class="fw-bold text-dark">{{ prediction.total_bilirubin }}</div>
                                            <div class="text-muted" style="font-size: 0.75rem;">mg/dL</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="bg-light rounded p-3 text-center">
                                            <div class="text-muted mb-1" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Direct Bilirubin</div>
                                            <div class="fw-bold text-dark">{{ prediction.direct_bilirubin }}</div>
                                            <div class="text-muted" style="font-size: 0.75rem;">mg/dL</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="bg-light rounded p-3 text-center">
                                            <div class="text-muted mb-1" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Alk. Phosphatase</div>
                                            <div class="fw-bold text-dark">{{ prediction.alkaline_phosphotase }}</div>
                                            <div class="text-muted" style="font-size: 0.75rem;">IU/L</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="bg-light rounded p-3 text-center">
                                            <div class="text-muted mb-1" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">ALT (SGPT)</div>
                                            <div class="fw-bold text-dark">{{ prediction.alamine_aminotransferase }}</div>
                                            <div class="text-muted" style="font-size: 0.75rem;">IU/L</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="bg-light rounded p-3 text-center">
                                            <div class="text-muted mb-1" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">AST (SGOT)</div>
                                            <div class="fw-bold text-dark">{{ prediction.aspartate_aminotransferase }}</div>
                                            <div class="text-muted" style="font-size: 0.75rem;">IU/L</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="bg-light rounded p-3 text-center">
                                            <div class="text-muted mb-1" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Total Proteins</div>
                                            <div class="fw-bold text-dark">{{ prediction.total_protiens }}</div>
                                            <div class="text-muted" style="font-size: 0.75rem;">g/dL</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="bg-light rounded p-3 text-center">
                                            <div class="text-muted mb-1" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Albumin</div>
                                            <div class="fw-bold text-dark">{{ prediction.albumin }}</div>
                                            <div class="text-muted" style="font-size: 0.75rem;">g/dL</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="bg-light rounded p-3 text-center">
                                            <div class="text-muted mb-1" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">A/G Ratio</div>
                                            <div class="fw-bold text-dark">{{ prediction.albumin_and_globulin_ratio }}</div>
                                            <div class="text-muted" style="font-size: 0.75rem;">ratio</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="col-12 col-lg-4">
                    <!-- Clinical Interpretation -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white border-bottom py-3">
                            <h6 class="mb-0 fw-semibold text-gray-900">
                                <i class="fas fa-stethoscope me-2 text-primary"></i>
                                Clinical Interpretation
                            </h6>
                        </div>
                        <div class="card-body p-4">
                            {% if prediction.prediction == 'No Disease' %}
                                <div class="alert alert-success border-0 bg-success bg-opacity-10" role="alert">
                                    <div class="d-flex align-items-start">
                                        <i class="fas fa-info-circle text-success mt-1 me-2"></i>
                                        <div>
                                            <div class="fw-semibold text-success mb-2">Normal Results</div>
                                            <p class="mb-0 text-success" style="font-size: 0.875rem;">
                                                Laboratory parameters indicate normal liver function with {{ prediction.confidence|floatformat:1 }}% confidence. Values are within expected ranges for healthy liver metabolism.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <h6 class="text-gray-700 mb-2" style="font-size: 0.875rem; font-weight: 600;">Recommendations:</h6>
                                    <ul class="list-unstyled text-muted" style="font-size: 0.875rem;">
                                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Continue healthy lifestyle</li>
                                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Regular medical check-ups</li>
                                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Balanced diet & exercise</li>
                                        <li class="mb-0"><i class="fas fa-check text-success me-2"></i>Limit alcohol intake</li>
                                    </ul>
                                </div>
                            {% else %}
                                <div class="alert alert-warning border-0 bg-warning bg-opacity-10" role="alert">
                                    <div class="d-flex align-items-start">
                                        <i class="fas fa-exclamation-triangle text-warning mt-1 me-2"></i>
                                        <div>
                                            <div class="fw-semibold text-warning mb-2">Abnormal Results</div>
                                            <p class="mb-0 text-warning" style="font-size: 0.875rem;">
                                                Analysis suggests potential liver disease with {{ prediction.confidence|floatformat:1 }}% confidence. Laboratory parameters indicate possible liver dysfunction.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <h6 class="text-gray-700 mb-2" style="font-size: 0.875rem; font-weight: 600;">Urgent Actions Required:</h6>
                                    <ul class="list-unstyled text-muted" style="font-size: 0.875rem;">
                                        <li class="mb-2"><i class="fas fa-exclamation text-danger me-2"></i>Consult hepatologist immediately</li>
                                        <li class="mb-2"><i class="fas fa-exclamation text-danger me-2"></i>Additional imaging studies</li>
                                        <li class="mb-2"><i class="fas fa-exclamation text-danger me-2"></i>Comprehensive blood work</li>
                                        <li class="mb-2"><i class="fas fa-exclamation text-danger me-2"></i>Avoid alcohol completely</li>
                                        <li class="mb-0"><i class="fas fa-exclamation text-danger me-2"></i>Follow dietary guidelines</li>
                                    </ul>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white border-bottom py-3">
                            <h6 class="mb-0 fw-semibold text-gray-900">
                                <i class="fas fa-bolt me-2 text-primary"></i>
                                Quick Actions
                            </h6>
                        </div>
                        <div class="card-body p-4">
                            <div class="d-grid gap-3">
                                <a href="{% url 'predictor:generate_liver_pdf_and_email' prediction.id %}" 
                                   class="btn btn-primary d-flex align-items-center justify-content-center">
                                    <i class="fas fa-file-pdf me-2"></i>
                                    Generate PDF Report
                                </a>
                                <a href="{% url 'predictor:liver_prediction' %}" 
                                   class="btn btn-outline-primary d-flex align-items-center justify-content-center">
                                    <i class="fas fa-plus me-2"></i>
                                    New Analysis
                                </a>
                                <a href="{% url 'predictor:reports_view' %}" 
                                   class="btn btn-secondary d-flex align-items-center justify-content-center">
                                    <i class="fas fa-chart-bar me-2"></i>
                                    View All Reports
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Info Footer -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card border-0 bg-light">
                        <div class="card-body py-3 px-4">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="d-flex align-items-center text-muted">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <small>
                                            This AI analysis is for informational purposes only and should not replace professional medical advice. 
                                            Please consult with a qualified healthcare provider for proper diagnosis and treatment.
                                        </small>
                                    </div>
                                </div>
                                <div class="col-md-4 text-md-end mt-2 mt-md-0">
                                    <small class="text-muted">
                                        <i class="fas fa-robot me-1"></i>
                                        Powered by Dr. Charaka AI
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
            <!-- Disclaimer -->
            <div class="row mt-5">
                <div class="col-12">
                    <div class="alert alert-info border-0" style="border-radius: 15px; background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);">
                        <div class="d-flex align-items-start">
                            <div class="flex-shrink-0">
                                <i class="fas fa-info-circle text-info" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="alert-heading mb-2">Important Disclaimer</h6>
                                <p class="mb-2">
                                    This AI-powered diabetes risk assessment is for informational purposes only and should not replace professional medical advice, diagnosis, or treatment. The predictions are based on machine learning algorithms trained on historical data and may not account for all individual health factors.
                                </p>
                                <p class="mb-0">
                                    <strong>Always consult with qualified healthcare professionals</strong> for proper medical evaluation and personalized health recommendations. If you have concerns about diabetes or other health conditions, seek immediate medical attention.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    </div>
</div>

<style>
/* Custom styles for cleaner SaaS look */
.bg-success.bg-opacity-10 {
    background-color: rgba(25, 135, 84, 0.1) !important;
}

.bg-warning.bg-opacity-10 {
    background-color: rgba(255, 193, 7, 0.1) !important;
}

.text-gray-900 {
    color: #1f2937 !important;
}

.text-gray-700 {
    color: #374151 !important;
}

.card {
    border-radius: 12px !important;
}

.card-header {
    border-radius: 12px 12px 0 0 !important;
}

.btn {
    border-radius: 8px !important;
    font-weight: 500 !important;
    padding: 0.75rem 1.5rem !important;
}

.badge {
    border-radius: 6px !important;
    font-weight: 500 !important;
}

.alert {
    border-radius: 8px !important;
}

.bg-light {
    border-radius: 8px !important;
}

@media (max-width: 768px) {
    .col-6:nth-child(odd) .bg-light {
        margin-right: 0.5rem;
    }
    
    .col-6:nth-child(even) .bg-light {
        margin-left: 0.5rem;
    }
}
</style>
{% endblock %}